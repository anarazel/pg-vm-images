{
    "builders": [
        {
            "name": "pg-aio-sid",
            "type": "googlecompute",
            "project_id": "pg-vm-images-aio",
            "source_image_family": "debian-10",
            "source_image_project_id": "debian-cloud",
            "image_name": "pg-aio-sid-{{user `image_date`}}",
            "image_family": "pg-aio-sid",
            "ssh_username": "root",
            "ssh_pty": "true",
            "zone": "us-west1-a",
            "machine_type" : "e2-highcpu-4",
            "preemptible": "true"
        },

        {
            "name": "pg-aio-bullseye",
            "type": "googlecompute",
            "project_id": "pg-vm-images-aio",
            "source_image_family": "debian-10",
            "source_image_project_id": "debian-cloud",
            "image_name": "pg-aio-bullseye-{{user `image_date`}}",
            "image_family": "pg-aio-bullseye",
            "ssh_username": "root",
            "ssh_pty": "true",
            "zone": "us-west1-a",
            "machine_type" : "e2-highcpu-4",
            "preemptible": "true"
        },

        {
            "name": "pg-aio-freebsd-12-2",
            "type": "googlecompute",
            "project_id": "pg-vm-images-aio",
            "source_image_family": "freebsd-12-2",
            "source_image_project_id": "freebsd-org-cloud-dev",
            "image_name": "pg-aio-freebsd-12-2-{{user `image_date`}}",
            "image_family": "pg-aio-freebsd-12-2",
            "ssh_username": "pg-vm-images-aio",
            "ssh_pty": "true",
            "zone": "us-west1-a",
            "machine_type" : "e2-highcpu-4",
            "preemptible": "true",
            "disk_size":"30"
        }
    ],
    "provisioners": [
        {
            "type": "shell",
            "inline": [
                "DEBIAN_FRONTEND=noninteractive apt-get purge man-db -y"
            ],
            "only" : ["pg-aio-bullseye", "pg-aio-sid"]
        },

        {
            "type": "shell",
            "inline": [
                "echo 'deb http://deb.debian.org/debian unstable main' > /etc/apt/sources.list",
                "echo 'deb-src http://deb.debian.org/debian unstable main' >> /etc/apt/sources.list",
                "apt-get update -y"
            ],
            "only" : ["pg-aio-sid"]
        },

        {
            "type": "shell",
            "inline": [
                "echo 'deb http://deb.debian.org/debian bullseye main' > /etc/apt/sources.list",
                "echo 'deb-src http://deb.debian.org/debian bullseye main' >> /etc/apt/sources.list",
                "apt-get update -y"
            ],
            "only" : ["pg-aio-bullseye"]
        },

        {
            "type": "shell",
            "inline": [
                "apt-get update -y",
                "DEBIAN_FRONTEND=noninteractive apt-get dist-upgrade --no-install-recommends -y"
            ],
            "only" : ["pg-aio-bullseye", "pg-aio-sid"]
        },

        {
            "type": "shell",
            "inline": [
                "DEBIAN_FRONTEND=noninteractive apt-get install -y --no-install-recommends git build-essential gcc g++ libreadline-dev flex bison make perl libipc-run-perl clang llvm-dev libperl-dev libpython3-dev tcl-dev libldap2-dev libicu-dev docbook-xml docbook-xsl fop libxml2-utils xsltproc krb5-admin-server krb5-kdc krb5-user slapd ldap-utils libssl-dev pkg-config locales-all liburing-dev python3-distutils ccache gdb"
            ],
            "only" : ["pg-aio-bullseye", "pg-aio-sid"]
        },

        {
            "type": "shell",
            "inline": [
                "DEBIAN_FRONTEND=noninteractive apt-get autoremove -y",
                "apt-get clean"
            ],
            "only" : ["pg-aio-bullseye", "pg-aio-sid"]
        },

        {
            "type": "shell",
            "inline": [
                "sudo pkg install -y readline flex bison gmake perl5 p5-IPC-Run ccache"
            ],
            "only" : ["pg-aio-freebsd-12-2"]
        }
    ]
}
